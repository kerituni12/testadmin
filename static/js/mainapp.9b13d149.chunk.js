(self.webpackChunkadminn=self.webpackChunkadminn||[]).push([[606],{57949:function(e,r,n){var t={"./en/common.json":[9384,122],"./en/errors.json":[14917,742],"./en/nono.json":[7435,903],"./vi/common.json":[14465,874],"./vi/errors.json":[98092,254],"./vi/nono.json":[8306,771]};function a(e){if(!n.o(t,e))return Promise.resolve().then((function(){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}));var r=t[e],a=r[0];return n.e(r[1]).then((function(){return n.t(a,19)}))}a.keys=function(){return Object.keys(t)},a.id=57949,e.exports=a},81921:function(e,r,n){"use strict";n.d(r,{F:function(){return t}});var t="network_error"},42813:function(e,r,n){"use strict";n.r(r);var t=n(66204),a=n(42457),s=n(242),o=(n(54265),n(31680)),c=n(2530),u={type:"backend",init:function(e,r,n){},read:function(e,r,t){n(57949)("./".concat(e,"/").concat(r,".json")).then((function(e){t(null,e)}))},save:function(e,r,n){},create:function(e,r,n,t){}};s.ZP.use(u).use(o.Z).use(c.Db).init({fallbackLng:!1,debug:!1,defaultNS:"common",ns:["common"],saveMissing:!0,missingKeyHandler:function(e,r,n,t){console.log(n)},react:{useSuspense:!1},load:"languageOnly",interpolation:{escapeValue:!1}});var i=n(72103),l=n(10605),d=n(96370),p=n(8414),f=n(34795),h=n(41361),m=n(33028),v=n(77162),g=n.n(v),y=n(79816),x=n(39383),k=n(72170),w=n(10103),Z=n(39433),j=n(99318),b=n(78732),P=n(7428),S=new y.u({uri:"http://localhost:3001/api/graphql",credentials:"include"}),C=(0,j.v)((function(e,r){var n=r.headers;console.log("get token");var t=localStorage.getItem("x-access-payload");return{headers:(0,m.Z)((0,m.Z)({},n),{},{"x-access-payload":t?"".concat(t):""})}})),T=!1,I=[],_=(0,b.q)((function(e){var r=e.graphQLErrors,n=e.networkError,t=e.operation,a=e.forward;if(r){var s,o=(0,h.Z)(r);try{for(o.s();!(s=o.n()).done;){var c;if("UNAUTHENTICATED"===s.value.extensions.code){var u=void 0;return T?u=(0,x.p)(new Promise((function(e){I.push((function(){return e()}))}))):(T=!0,u=(0,x.p)(N().then((function(e){var r=e.accessTokenPayload,n=e.refreshTokenPayload;return localStorage.setItem("x-refresh-payload",n),localStorage.setItem("x-access-payload",r),I.map((function(e){return e()})),I=[],r})).catch((function(e){return I=[],e})).finally((function(){T=!1}))).filter((function(e){return Boolean(e)}))),u.flatMap((function(e){var r=t.getContext().headers;return t.setContext({headers:(0,m.Z)((0,m.Z)({},r),{},{"x-access-payload":e})}),a(t)}))}}}catch(c){o.e(c)}finally{o.f()}}n&&console.log("[Network error]: ".concat(n))}));function N(){return E.apply(this,arguments)}function E(){return(E=(0,f.Z)(g().mark((function e(){var r,n,t,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=localStorage.getItem("x-refresh-payload"),e.next=3,P.Z.get("".concat("http://localhost:3001","/api/auth/refresh"),{headers:{"Content-Type":"application/json","x-refresh-payload":r}});case 3:return n=e.sent,t=n.accessTokenPayload,a=n.refreshTokenPayload,e.abrupt("return",{accessTokenPayload:t,refreshTokenPayload:a});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=new k.f({cache:new w.h,link:Z.i.from([C,_,S])}),L=n(8973),M=n(7759),O=n(43188),R=(0,t.lazy)((function(){return Promise.all([n.e(235),n.e(768)]).then(n.bind(n,57041))})),z=(0,M.p5)(l.Z);a.render((0,O.jsx)(i.zt,{store:l.Z,children:(0,O.jsx)(L.r,{loading:(0,O.jsx)("div",{className:"center-screen",children:(0,O.jsx)(d.Z,{size:"large"})}),persistor:z,children:(0,O.jsx)(p.e,{client:U,children:(0,O.jsx)(t.Suspense,{fallback:(0,O.jsx)("div",{className:"center-screen",children:(0,O.jsx)(d.Z,{size:"large"})}),children:(0,O.jsx)(R,{})})})})}),document.getElementById("root"))},86530:function(e,r,n){"use strict";n.d(r,{x4:function(){return l}});var t=n(34795),a=n(77162),s=n.n(a),o=n(40540),c=n(70239),u=n(7428),i=(0,o.oM)({name:"auth",initialState:{isAuthenticated:!1},reducers:{logoutSuccess:function(e){e.isAuthenticated=!1},authSuccess:function(e){e.isAuthenticated=!0}}}),l=(0,o.hg)("login",function(){var e=(0,t.Z)(s().mark((function e(r,n){var t,a,o,i,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.email,a=r.password,o=n.dispatch,e.prev=2,e.next=5,u.Z.post("".concat("http://localhost:3001","/api/auth/login"),{email:t,password:a});case 5:return i=e.sent,l=i.data,console.log("\ud83d\ude80 ~ file: auth.slice.js ~ line 29 ~ data",l),localStorage.setItem("x-access-payload",l.accessTokenPayload),localStorage.setItem("x-refresh-payload",l.refreshTokenPayload),o((0,c.av)({name:"hieu",permissions:new Set(l.permissions)})),e.abrupt("return",{data:l});case 14:return e.prev=14,e.t0=e.catch(2),e.abrupt("return",{error:e.t0});case 17:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(r,n){return e.apply(this,arguments)}}()),d=((0,o.hg)("logout",function(){var e=(0,t.Z)(s().mark((function e(r,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,n.dispatch)(p()),e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),i.actions),p=d.logoutSuccess;d.authSuccess;r.ZP=i.reducer},70239:function(e,r,n){"use strict";n.d(r,{av:function(){return s}});var t=(0,n(40540).oM)({name:"user",initialState:{name:null,permissions:null},reducers:{setUser:function(e,r){var n=r.payload,t=n.name,a=n.permissions;e.name=t,e.permissions=a},setPermission:function(e,r){e.permission=r.payload.permission}}}),a=t.actions,s=a.setUser;a.setPermission;r.ZP=t.reducer},7428:function(e,r,n){"use strict";var t=n(33028),a=n(34795),s=n(77162),o=n.n(s),c=n(72473),u=n(81921),i=n(61674),l=n.n(i)().create({baseURL:c.Mr,headers:{"Content-Type":"application/json"},withCredentials:!0});function d(e){var r;return e.response?(0,t.Z)((0,t.Z)({},e.response.data),{},{statusCode:(null===(r=e.response)||void 0===r?void 0:r.status)||e.response.data.statusCode}):"Network Error"===e.message?{statusCode:500,errorCode:u.F,message:e.message}:{statusCode:555,errorCode:"unknow_platform_error",message:e.message}}l.interceptors.request.use((function(e){return e.headers[c._L]=localStorage.getItem(c._L),e}),(function(e){return Promise.reject(e)})),l.interceptors.response.use((function(e){return e}),function(){var e=(0,a.Z)(o().mark((function e(r){var n,t,a,s,u,i,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.config,s=d(r),401!==(null===(n=r.response)||void 0===n?void 0:n.status)||a.url!=="".concat(c.Mr,"/").concat(c.Xd,"/auth/login")){e.next=4;break}return e.abrupt("return",Promise.reject(s));case 4:if(401!==(null===(t=r.response)||void 0===t?void 0:t.status)||a._retry){e.next=19;break}return a._retry=!0,e.prev=6,e.next=9,l.post("/refresh");case 9:return u=e.sent,i=u.data,localStorage.setItem(c._L,i.refresh),e.abrupt("return",l(a));case 15:return e.prev=15,e.t0=e.catch(6),p=d(e.t0),e.abrupt("return",Promise.reject(p));case 19:return e.abrupt("return",Promise.reject(s));case 20:case"end":return e.stop()}}),e,null,[[6,15]])})));return function(r){return e.apply(this,arguments)}}()),r.Z=l},10605:function(e,r,n){"use strict";n.d(r,{Z:function(){return h},f:function(){return f}});var t=n(7759),a=n(21370),s=n(40540),o=n(33028),c=n(1335),u=n(86530),i=function(e){return(0,c.UY)((0,o.Z)({auth:u.ZP},e))},l={key:"root",storage:a.Z,debug:!0},d=(0,t.OJ)(l,i()),p=(0,s.xC)({reducer:d,devTools:!1,middleware:function(e){return e({serializableCheck:!1})}});function f(e,r){return!p.asyncReducers[e]&&(p.asyncReducers[e]=r,p.replaceReducer(i(p.asyncReducers)),p)}p.asyncReducers={};var h=p}}]);
//# sourceMappingURL=mainapp.9b13d149.chunk.js.map